import{q as K,v as Z,r as u,w as J,x as U,j as e,y as B,z as q,E as V,F as Y,G as ee,H as L,J as se,e as b,K as te,S as I,L as ae,t as re,h as F,u as H,i as k,C as v,f as R,g as S,M as $,d as y,N as ne,B as T,m as D,T as ce,o as C,p as ie,Z as le}from"./index-DCOvJKlU.js";import{P as oe}from"./progress-m_owvb2C.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=K("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=K("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var A="Checkbox",[xe,ye]=Z(A),[ue,pe]=xe(A),Q=u.forwardRef((s,c)=>{const{__scopeCheckbox:r,name:n,checked:o,defaultChecked:l,required:d,disabled:t,value:m="on",onCheckedChange:i,form:a,...h}=s,[x,g]=u.useState(null),w=J(c,p=>g(p)),E=u.useRef(!1),G=x?a||!!x.closest("form"):!0,[j=!1,P]=U({prop:o,defaultProp:l,onChange:i}),W=u.useRef(j);return u.useEffect(()=>{const p=x==null?void 0:x.form;if(p){const N=()=>P(W.current);return p.addEventListener("reset",N),()=>p.removeEventListener("reset",N)}},[x,P]),e.jsxs(ue,{scope:r,state:j,disabled:t,children:[e.jsx(B.button,{type:"button",role:"checkbox","aria-checked":f(j)?"mixed":j,"aria-required":d,"data-state":O(j),"data-disabled":t?"":void 0,disabled:t,value:m,...h,ref:w,onKeyDown:q(s.onKeyDown,p=>{p.key==="Enter"&&p.preventDefault()}),onClick:q(s.onClick,p=>{P(N=>f(N)?!0:!N),G&&(E.current=p.isPropagationStopped(),E.current||p.stopPropagation())})}),G&&e.jsx(he,{control:x,bubbles:!E.current,name:n,value:m,checked:j,required:d,disabled:t,form:a,style:{transform:"translateX(-100%)"},defaultChecked:f(l)?!1:l})]})});Q.displayName=A;var z="CheckboxIndicator",_=u.forwardRef((s,c)=>{const{__scopeCheckbox:r,forceMount:n,...o}=s,l=pe(z,r);return e.jsx(V,{present:n||f(l.state)||l.state===!0,children:e.jsx(B.span,{"data-state":O(l.state),"data-disabled":l.disabled?"":void 0,...o,ref:c,style:{pointerEvents:"none",...s.style}})})});_.displayName=z;var he=s=>{const{control:c,checked:r,bubbles:n=!0,defaultChecked:o,...l}=s,d=u.useRef(null),t=Y(r),m=ee(c);u.useEffect(()=>{const a=d.current,h=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(h,"checked").set;if(t!==r&&g){const w=new Event("click",{bubbles:n});a.indeterminate=f(r),g.call(a,f(r)?!1:r),a.dispatchEvent(w)}},[t,r,n]);const i=u.useRef(f(r)?!1:r);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:o??i.current,...l,tabIndex:-1,ref:d,style:{...s.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function f(s){return s==="indeterminate"}function O(s){return f(s)?"indeterminate":s?"checked":"unchecked"}var X=Q,fe=_;const M=u.forwardRef(({className:s,...c},r)=>e.jsx(X,{ref:r,className:L("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...c,children:e.jsx(fe,{className:L("flex items-center justify-center text-current"),children:e.jsx(se,{className:"h-4 w-4"})})}));M.displayName=X.displayName;function ge({type:s="generated",size:c="sm",showIcon:r=!0}){const o=(()=>{switch(s){case"insight":return{icon:re,text:"AI洞察",className:"bg-purple-100 text-purple-700 border-purple-200"};case"suggestion":return{icon:ae,text:"AI建议",className:"bg-blue-100 text-blue-700 border-blue-200"};case"analysis":return{icon:I,text:"AI分析",className:"bg-green-100 text-green-700 border-green-200"};default:return{icon:te,text:"AI生成",className:"bg-gray-100 text-gray-700 border-gray-200"}}})(),l=o.icon;return e.jsxs(b,{variant:"outline",className:`${o.className} ${c==="sm"?"text-xs":"text-sm"} font-medium`,children:[r&&e.jsx(l,{className:`${c==="sm"?"w-3 h-3":"w-4 h-4"} mr-1`}),o.text]})}function je({onGoalCreated:s}){const[c,r]=u.useState(""),[n,o]=u.useState(null),l=F(),{toast:d}=H(),t=k({mutationFn:async i=>await C("POST","/api/goals/intelligent-create",{description:i}),onSuccess:i=>{o(i),r(""),l.invalidateQueries({queryKey:["/api/goals"]}),d({title:"目标创建成功",description:"AI已为您智能分析并创建了结构化目标"}),s==null||s()},onError:i=>{console.error("创建目标失败:",i),d({title:"创建失败",description:"智能目标创建失败，请重试",variant:"destructive"})}}),m=()=>{if(!c.trim()){d({title:"请输入目标描述",description:"请详细描述您想要实现的目标",variant:"destructive"});return}t.mutate(c)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(v,{className:"border-purple-200 dark:border-purple-800",children:[e.jsxs(R,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-purple-500"}),"AI智能目标创建"]}),e.jsx($,{className:"text-muted-foreground",children:"描述您的目标，AI将自动分析并创建结构化的主线任务，包含经验奖励、金币奖励和里程碑"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsx(ne,{placeholder:"例如：我想学习Python编程，从基础语法开始到能够开发简单的Web应用...",value:c,onChange:i=>r(i.target.value),rows:4,className:"resize-none bg-background border-border text-foreground placeholder:text-muted-foreground"}),e.jsx(T,{onClick:m,disabled:t.isPending||!c.trim(),className:"w-full bg-purple-700 hover:bg-purple-800 font-medium text-white border-0",style:{backgroundColor:"#7c3aed",color:"#ffffff",fontWeight:"600",border:"none"},children:t.isPending?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"mr-2 h-4 w-4 animate-spin"}),"AI正在分析中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"创建智能目标"]})})]})]}),n&&e.jsxs(v,{className:"border-green-200 dark:border-green-800 bg-card border-border",children:[e.jsxs(R,{children:[e.jsxs(S,{className:"flex items-center gap-2 text-green-600",children:[e.jsx(D,{className:"h-5 w-5"}),"创建成功: ",n.title,e.jsx(ge,{type:"generated"})]}),e.jsx($,{className:"text-muted-foreground",children:n.description})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(b,{variant:"secondary",className:"flex items-center gap-1 bg-purple-100 text-purple-700",children:[e.jsx(ce,{className:"h-3 w-3"}),"完成奖励: ",n.expReward," EXP"]}),e.jsxs(b,{variant:"secondary",className:"flex items-center gap-1 bg-yellow-100 text-yellow-700",children:[e.jsx(de,{className:"h-3 w-3"}),n.goldReward," 金币"]}),e.jsxs(b,{variant:"outline",className:"flex items-center gap-1 border-blue-500 text-blue-400",children:[e.jsx(D,{className:"h-3 w-3"}),"番茄钟: ",n.pomodoroExpReward," EXP + ",n.pomodoroGoldReward," 金币"]})]}),n.skillTags&&n.skillTags.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"关联技能:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:n.skillTags.map((i,a)=>e.jsx(b,{variant:"outline",className:"text-xs border-slate-500 text-slate-300",children:i},a))})]}),n.milestones&&n.milestones.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"自动生成的里程碑:"}),e.jsx("div",{className:"space-y-2",children:n.milestones.map((i,a)=>e.jsxs("div",{className:"flex items-start gap-3 p-2 bg-slate-700 rounded",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full flex-shrink-0 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-white",children:i.title}),i.description&&e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:i.description})]})]},a))})]}),e.jsx("div",{className:"pt-2 border-t border-slate-600",children:e.jsx("p",{className:"text-xs text-slate-400",children:"目标已成功创建并添加到主线任务列表中，现在可以开始挑战Boss！"})})]})]})]})}function ke(){const{toast:s}=H(),c=F(),{data:r=[],isLoading:n}=ie({queryKey:["/api/goals"],staleTime:2*60*1e3}),o=k({mutationFn:async({id:a,updates:h})=>await C("PATCH",`/api/goals/${a}`,h),onSuccess:()=>{c.invalidateQueries({queryKey:["/api/goals"]}),s({title:"目标已更新",description:"目标状态已成功更新"})},onError:()=>{s({title:"更新失败",description:"目标状态更新失败，请重试",variant:"destructive"})}}),l=k({mutationFn:async a=>await C("DELETE",`/api/goals/${a}`),onSuccess:()=>{c.invalidateQueries({queryKey:["/api/goals"]}),s({title:"目标已删除",description:"目标已成功删除"})},onError:()=>{s({title:"删除失败",description:"目标删除失败，请重试",variant:"destructive"})}}),d=k({mutationFn:async({goalId:a,milestoneId:h,completed:x})=>await C("PATCH",`/api/goals/${a}/milestones/${h}`,{completed:x}),onSuccess:()=>{c.invalidateQueries({queryKey:["/api/goals"]})},onError:()=>{s({title:"更新失败",description:"里程碑状态更新失败",variant:"destructive"})}}),t=a=>{console.log("Edit goal:",a)},m=a=>{o.mutate({id:a.id,updates:{completed:!a.completed}})},i=a=>{confirm("确定要删除这个目标吗？")&&l.mutate(a.id)};return n?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center",children:[e.jsx("i",{className:"fas fa-flag text-amber-400 mr-3"}),"主线任务"]})}),e.jsx("div",{className:"grid gap-6",children:[1,2,3].map(a=>e.jsx(v,{className:"bg-slate-800 border-slate-700 animate-pulse",children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-4 bg-slate-600 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-slate-600 rounded w-1/2"})]})})},a))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center",children:[e.jsx("i",{className:"fas fa-flag text-amber-400 mr-3"}),"主线任务"]})}),e.jsx("div",{className:"space-y-4",children:e.jsx(je,{onGoalCreated:()=>{c.invalidateQueries({queryKey:["/api/goals"]})}})}),e.jsx("div",{className:"space-y-4",children:r.length===0?e.jsx(v,{className:"bg-slate-800 border-slate-700",children:e.jsx(y,{className:"p-8 text-center",children:e.jsxs("div",{className:"text-gray-400 mb-4",children:[e.jsx("i",{className:"fas fa-flag text-4xl text-gray-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"还没有任何目标"}),e.jsx("p",{className:"text-sm",children:"使用上方的AI智能创建来添加您的第一个目标"})]})})}):r.map(a=>e.jsx(be,{goal:a,onEditGoal:t,onToggleCompletion:m,onDeleteGoal:i,onUpdateMilestone:({goalId:h,milestoneId:x,completed:g})=>{d.mutate({goalId:h,milestoneId:x,completed:g})}},a.id))})]})}function be({goal:s,onEditGoal:c,onToggleCompletion:r,onDeleteGoal:n,onUpdateMilestone:o}){const d=(t=>!t.milestones||t.milestones.length===0?0:t.milestones.filter(i=>i.completed).length/t.milestones.length*100)(s);return e.jsxs(v,{className:`bg-card border-border transition-all duration-200 ${s.completed?"opacity-60":""}`,children:[e.jsx(R,{className:"pb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx(M,{checked:s.completed,onCheckedChange:()=>r(s),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(S,{className:`text-lg ${s.completed?"line-through text-muted-foreground":"text-foreground"}`,children:s.title}),s.description&&e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>n(s),className:"text-destructive hover:bg-destructive/10",children:"删除"}),e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>r(s),className:"text-primary hover:bg-primary/10",children:"标记完成"})]})]})}),e.jsxs(y,{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between bg-muted/30 rounded-lg p-3",children:e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex items-center space-x-1 text-primary",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["+",s.expReward||0," EXP"]})]})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"完成进度"}),e.jsxs("span",{className:"text-foreground",children:[Math.round(d),"%"]})]}),e.jsx(oe,{value:d,className:"h-2"})]}),s.milestones&&s.milestones.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-foreground font-medium flex items-center",children:[e.jsx("i",{className:"fas fa-flag text-accent mr-2"}),"里程碑进展"]}),e.jsx("div",{className:"space-y-2",children:s.milestones.map(t=>e.jsxs("div",{className:"flex items-start space-x-3 p-2 bg-muted/50 rounded border border-border",children:[e.jsx(M,{checked:t.completed,onCheckedChange:m=>{o({goalId:s.id,milestoneId:t.id,completed:!!m})},className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium leading-tight ${t.completed?"text-muted-foreground line-through":"text-foreground"}`,children:t.title}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 leading-tight",children:t.description})]}),t.completed&&e.jsx("i",{className:"fas fa-check-circle text-primary flex-shrink-0 text-sm mt-0.5"})]},t.id))})]}),s.skillTags&&s.skillTags.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("h4",{className:"text-foreground font-medium text-sm flex items-center",children:[e.jsx("i",{className:"fas fa-brain text-secondary mr-2"}),"相关技能"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.skillTags.map((t,m)=>e.jsx(b,{variant:"secondary",className:"bg-secondary/20 text-secondary-foreground hover:bg-secondary/30",children:t},m))})]})]})]})}export{ke as default};
