import{r as _,u as M,p,i as T,j as e,C as l,d as r,B as W,f as b,g as y,e as w,o as P}from"./index-DCOvJKlU.js";import{S as $,a as q,b as B,c as F,d as H}from"./select-BrhrkHIp.js";function G(){const[d,v]=_.useState(0),{toast:u}=M(),{data:k=[]}=p({queryKey:["/api/activity-logs"]}),{data:S=[]}=p({queryKey:["/api/skills"]}),{data:D=[]}=p({queryKey:["/api/tasks"]}),a=T({mutationFn:async s=>(await P("POST","/api/weekly-summary/generate",{weekOffset:s})).json(),onSuccess:s=>{u({title:"总结生成成功",description:"AI 已为您生成本周工作总结"})},onError:s=>{u({title:"生成失败",description:"生成每周总结时出现错误，请重试",variant:"destructive"})}}),C=s=>{const t=new Date,c=t.getDay(),g=c===0?6:c-1,i=new Date(t);i.setDate(t.getDate()-g-s*7),i.setHours(0,0,0,0);const j=new Date(i);return j.setDate(i.getDate()+6),j.setHours(23,59,59,999),{weekStart:i,weekEnd:j}},{weekStart:x,weekEnd:m}=C(d),N=k.filter(s=>{const t=new Date(s.date);return t>=x&&t<=m}),n=D.filter(s=>{const t=new Date(s.createdAt);return t>=x&&t<=m}),f=n.filter(s=>s.completed).length,A=N.filter(s=>s.action==="task_completed"||s.action==="task_completed_with_pomodoro").reduce((s,t)=>s+t.expGained,0),o=new Map;N.filter(s=>s.skillId&&(s.action==="task_completed"||s.action==="task_completed_with_pomodoro")).forEach(s=>{const t=o.get(s.skillId)||0;o.set(s.skillId,t+s.expGained)});const h=Array.from(o.entries()).map(([s,t])=>{const c=S.find(g=>g.id===s);return c?{name:c.name,exp:t,color:c.color}:null}).filter(Boolean).sort((s,t)=>t.exp-s.exp).slice(0,5),E=(s,t)=>`${s.getMonth()+1}月${s.getDate()}日 - ${t.getMonth()+1}月${t.getDate()}日`,I=s=>s===0?"本周":s===1?"上周":`${s}周前`;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl p-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2 text-white",children:"📊 每周总结"}),e.jsx("p",{className:"text-white/90",children:"AI 智能分析你的每周工作表现和成长轨迹"})]}),e.jsx(l,{className:"bg-slate-800 border-slate-700",children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs($,{value:d.toString(),onValueChange:s=>v(parseInt(s)),children:[e.jsx(q,{className:"w-[140px] bg-slate-700 border-slate-600 text-white",children:e.jsx(B,{placeholder:"选择周期"})}),e.jsx(F,{className:"bg-slate-700 border-slate-600",children:[0,1,2,3,4].map(s=>e.jsx(H,{value:s.toString(),className:"text-white",children:I(s)},s))})]}),e.jsx("div",{className:"text-white",children:E(x,m)})]}),e.jsx(W,{onClick:()=>a.mutate(d),disabled:a.isPending,className:"bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600",children:a.isPending?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"生成中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-magic mr-2"}),"生成 AI 总结"]})})]})})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(l,{className:"bg-slate-800 border-slate-700",children:e.jsxs(r,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:f}),e.jsx("div",{className:"text-sm text-gray-400",children:"任务完成"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["总共 ",n.length," 个任务"]})]})}),e.jsx(l,{className:"bg-slate-800 border-slate-700",children:e.jsxs(r,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:A}),e.jsx("div",{className:"text-sm text-gray-400",children:"经验获得"}),e.jsx("div",{className:"text-xs text-gray-500",children:"XP 值"})]})}),e.jsx(l,{className:"bg-slate-800 border-slate-700",children:e.jsxs(r,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-400",children:h.length}),e.jsx("div",{className:"text-sm text-gray-400",children:"活跃技能"}),e.jsx("div",{className:"text-xs text-gray-500",children:"有进展的技能数"})]})}),e.jsx(l,{className:"bg-slate-800 border-slate-700",children:e.jsxs(r,{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-amber-400",children:[n.length>0?Math.round(f/n.length*100):0,"%"]}),e.jsx("div",{className:"text-sm text-gray-400",children:"完成率"}),e.jsx("div",{className:"text-xs text-gray-500",children:"任务完成率"})]})})]}),h.length>0&&e.jsxs(l,{className:"bg-slate-800 border-slate-700",children:[e.jsx(b,{children:e.jsxs(y,{className:"text-white flex items-center",children:[e.jsx("i",{className:"fas fa-chart-bar text-blue-400 mr-2"}),"技能进展排行"]})}),e.jsx(r,{className:"space-y-3",children:h.map((s,t)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[e.jsxs("div",{className:"text-lg font-bold text-gray-400",children:["#",t+1]}),e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:s.color}}),e.jsx("div",{className:"text-white font-medium",children:s.name})]}),e.jsxs(w,{className:"bg-green-500/20 text-green-400",children:["+",s.exp," XP"]})]},s.name))})]}),a.data&&e.jsxs(l,{className:"bg-slate-800 border-slate-700",children:[e.jsx(b,{children:e.jsxs(y,{className:"text-white flex items-center",children:[e.jsx("i",{className:"fas fa-robot text-purple-400 mr-2"}),"AI 智能分析报告"]})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-white font-medium mb-2 flex items-center",children:[e.jsx("i",{className:"fas fa-lightbulb text-yellow-400 mr-2"}),"总体洞察"]}),e.jsx("p",{className:"text-gray-300 leading-relaxed",children:a.data.insights})]}),a.data.recommendations&&a.data.recommendations.length>0&&e.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-white font-medium mb-3 flex items-center",children:[e.jsx("i",{className:"fas fa-compass text-blue-400 mr-2"}),"改进建议"]}),e.jsx("ul",{className:"space-y-2",children:a.data.recommendations.map((s,t)=>e.jsxs("li",{className:"text-gray-300 flex items-start",children:[e.jsx("i",{className:"fas fa-arrow-right text-green-400 mr-2 mt-1 text-xs"}),s]},t))})]}),a.data.focusAreas&&a.data.focusAreas.length>0&&e.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-white font-medium mb-3 flex items-center",children:[e.jsx("i",{className:"fas fa-target text-red-400 mr-2"}),"下周重点关注"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.data.focusAreas.map((s,t)=>e.jsx(w,{className:"bg-indigo-500/20 text-indigo-300 border-indigo-400",children:s},t))})]})]})]}),n.length===0&&e.jsx(l,{className:"bg-slate-800 border-slate-700",children:e.jsxs(r,{className:"text-center py-12",children:[e.jsx("i",{className:"fas fa-calendar-times text-4xl text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"该周暂无数据"}),e.jsx("p",{className:"text-gray-400",children:"这一周还没有任务记录，去完成一些任务吧！"})]})})]})}export{G as default};
