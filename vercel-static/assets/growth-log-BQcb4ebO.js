import{r as p,p as i,j as e,C as o,d as x,e as j}from"./index-DCOvJKlU.js";import{S as g,a as N,b as v,c as y,d as l}from"./select-BrhrkHIp.js";function q(){const[d,b]=p.useState("daily"),[m,w]=p.useState("newest"),{data:u=[]}=i({queryKey:["/api/activity-logs"]}),{data:h=[]}=i({queryKey:["/api/skills"]}),{data:k=[]}=i({queryKey:["/api/tasks"]}),D=t=>{if(!t)return"";const s=h.find(r=>r.id===t);return(s==null?void 0:s.name)||""},_=t=>{if(!t)return"#6B7280";const s=h.find(r=>r.id===t);return(s==null?void 0:s.color)||"#6B7280"},S=t=>{if(!t)return"";const s=k.find(r=>r.id===t);return(s==null?void 0:s.title)||""},f=u.filter(t=>{if(d==="daily")return!0;if(d==="weekly"){const s=new Date;return s.setDate(s.getDate()-7),new Date(t.date)>=s}if(d==="monthly"){const s=new Date;return s.setMonth(s.getMonth()-1),new Date(t.date)>=s}return!0}).reduce((t,s)=>{const r=new Date(s.date).toDateString();return t[r]||(t[r]=[]),t[r].push(s),t},{}),C=Object.keys(f).sort((t,s)=>m==="newest"?new Date(s).getTime()-new Date(t).getTime():new Date(t).getTime()-new Date(s).getTime()),T=t=>{const s=new Date(t),r=new Date().toDateString(),c=new Date(Date.now()-864e5).toDateString();return t===r?"今天":t===c?"昨天":s.toLocaleDateString("zh-CN",{month:"long",day:"numeric",weekday:"long"})},I=t=>{switch(t){case"task_completed":return"任务完成";case"skill_levelup":return"技能升级";case"goal_completed":return"目标完成";default:return"活动"}},L=t=>{const s=t.filter(a=>a.action==="task_completed"||a.action==="task_completed_with_pomodoro").length,r=t.filter(a=>a.action==="task_completed"||a.action==="task_completed_with_pomodoro").reduce((a,B)=>a+B.expGained,0),c=new Set(t.filter(a=>(a.action==="task_completed"||a.action==="task_completed_with_pomodoro")&&a.skillId).map(a=>a.skillId)).size,n=t.filter(a=>a.action==="skill_levelup").length;return{completedTasks:s,totalExp:r,skillsImproved:c,levelUps:n}};return e.jsxs("div",{className:"min-h-screen bg-background p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/20 to-accent/20 border border-primary/20 rounded-2xl p-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2 text-foreground",children:"📈 升级记录"}),e.jsx("p",{className:"text-muted-foreground",children:"查看你的经验值获取和能力提升历程"})]}),e.jsx(o,{className:"bg-card border-border",children:e.jsx(x,{className:"p-6",children:e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[e.jsxs(g,{value:d,onValueChange:b,children:[e.jsx(N,{className:"w-[140px]",children:e.jsx(v,{placeholder:"筛选时间"})}),e.jsxs(y,{children:[e.jsx(l,{value:"daily",children:"按日查看"}),e.jsx(l,{value:"weekly",children:"按周查看"}),e.jsx(l,{value:"monthly",children:"按月查看"})]})]}),e.jsxs(g,{value:m,onValueChange:w,children:[e.jsx(N,{className:"w-[140px]",children:e.jsx(v,{placeholder:"排序方式"})}),e.jsxs(y,{children:[e.jsx(l,{value:"newest",children:"最新优先"}),e.jsx(l,{value:"oldest",children:"最早优先"}),e.jsx(l,{value:"most_exp",children:"经验最多"})]})]})]})})})}),e.jsx("div",{className:"space-y-6",children:u.length===0?e.jsx(o,{className:"bg-card border-border",children:e.jsxs(x,{className:"text-center py-12",children:[e.jsx("i",{className:"fas fa-book text-4xl text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:"还没有升级记录"}),e.jsx("p",{className:"text-muted-foreground",children:"完成一些任务来开始记录你的升级历程吧！"})]})}):C.map(t=>{const s=f[t],r=L(s),c=t===new Date().toDateString();return e.jsx(o,{className:"bg-card border-border",children:e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${c?"bg-primary text-primary-foreground":"bg-green-600 text-white"}`,children:e.jsx("i",{className:"fas fa-calendar-day"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-foreground",children:new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:T(t)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold text-green-600",children:["+",r.totalExp," XP"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r.completedTasks,"个任务完成"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:r.completedTasks}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"任务完成"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.totalExp}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"经验获得"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-accent",children:r.skillsImproved}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"技能提升"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:r.levelUps}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"等级提升"})]})]}),e.jsx("div",{className:"space-y-3",children:s.map(n=>e.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-background border border-border rounded-lg hover:bg-muted transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm",style:{backgroundColor:_(n.skillId)},children:e.jsx("i",{className:"fas fa-star"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{variant:"secondary",className:"bg-primary/20 text-primary",children:I(n.action)}),n.skillId&&e.jsx(j,{variant:"outline",className:"border-border text-foreground",children:D(n.skillId)})]}),e.jsx("p",{className:"text-foreground font-medium truncate mt-1",children:n.description||(n.taskId?S(n.taskId):"活动记录")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(n.date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-green-600 dark:text-green-400 font-bold",children:["+",n.expGained," XP"]})})]},n.id))})]})},t)})})]})}export{q as default};
